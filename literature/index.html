<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" type="image/x-icon" href="../favicon.ico">
	<title>Mintverse</title>
	<meta property="og:image" content="../cover.png"/>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="../css/_reset.css">
	<link rel="stylesheet" href="../css/header.css">
	<link rel="stylesheet" href="../css/footer.css">
	<link rel="stylesheet" href="../css/literature.css">
	<link rel="stylesheet" href="../css/article.css">
	<script src="../js/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/jquery.marquee@1.6.0/jquery.marquee.min.js"></script>
	<script src="../js/header.js"></script>
	<script src="../js/footer.js"></script>
</head>
<body>
	<div id="app">
		<header>
		</header>
		<section class="literature">
			<h3>鑄造小組發現了人類僅存的十篇文獻，然而文獻中的詞彙盡皆散佚，等待各位注入定義後解鎖。</h3>
			<div class="cardContainer">
			</div>
		</section>
		<section class="article">
			<div class="back"><img src="../image/back.svg" alt=""> 返回</div>
			<h1 class="title"></h1>
			<h3 class="author"></h3>
			<button><img src="../image/back_orange.svg" alt="">其他的可能宇宙</button>
			<div class="content"></div>
			<div class="goTop"><img src="../image/back.svg" alt="">TOP</div>
		</section>
		<div class="message">
			<div class="word">
				<a href=""  target="_blank" ><img src="../image/opensea.png" alt=""></a>
				<p></p>
			</div>
			<div class="context"></div>
		</div>
		<footer>
		</footer>
	</div>
	<script>
		$(document).ready(function() {
			let data = [
				{
					title:'垃圾夢',
					author:'甘耀明',
					persent:0,
					article: '男人不知道挖掘了多久，也許半輩子，用時間度量無用。挖掘區是人類垃圾堆，堆積的廢棄物在長年堆積與壓力下，形成堅硬密度的物質層，努力建造的文明與文化在此坍陷濃縮。無數的挖掘客在裡鑽出通道，處處是焦黑、沼氣與死亡，這是地底的陰鬱之城，要活下去得繼續挖，尋找堪用物資。男人不知道自己歲數，時間是無用，也無須擔心死亡。有伴才是好的。他撿到兩個小跟班，一個是小男孩，還有一隻羊駝。如果撿到鯨魚更好，聽說這種大魚很容易遇到，養起來也很容易。這誘惑令他不斷挖掘，如果多幾個伴，人生不再是無聊的悲劇了。時間無用，有用的是貴重金屬或食物。男人隨後挖到一個嗡嗡叫的冰箱，彷彿說「快打開我、快我開我」，打開後傾巢湧出上千隻蟑螂，他們連忙拍死了十幾隻，並燃燒瀝青煮罐頭，放入新鮮蟑螂，摻入豆芽、薤白與紅豆。長久在陰暗隧道工作，非常適合邊挖邊孵豆芽。他今天還在罐頭菜加了換來的芋頭乾。種芋頭要水，那麼珍貴的東西竟然拿來呵護這種植物，他沒看過活生生的芋頭，甚至忘了乾淨的水聲是如何鳴唱。他們的用水取自羊駝尿，牠能吸收空氣水分，製造尿水。萬能製水機。聞燃燒的瀝青有種麻醉效果，一種微微吸毒的恍惚，萌生幸福與和平感，像回到家。燒瀝青的微弱光源，照亮男孩，只有這時候才能看見他稚嫩臉龐上的大腫瘤，將五官撐開成遠距離的廢棄品。',
					text:'男人'
				},
				{
					title:'島族風聲',
					author:'朱宥勳',
					persent:0,
				},
				{
					title:'還沒有名字的貓',
					author:'李屏瑤',
					persent:0,
				},
				{
					title:'靈魂加載員',
					author:'臥斧',
					persent:0,
				},
				{
					title:'獅王三溫暖',
					author:'陳信傑',
					persent:0,
				},
				{
					title:'甜美的果實',
					author:'張西',
					persent:0,
				},
				{
					title:'廢船之歌',
					author:'張亦絢',
					persent:0,
				},
				{
					title:'地球殘卷選譯／〈疑偽部第七章第十九條目〉・年代不明',
					author:'黃麗群',
					persent:0,
				},
				{
					title:'愛情靈藥',
					author:'楊双子',
					persent:0,
				},
				{
					title:'失樂園',
					author:'瀟湘神',
					persent:0,
				},
			]
			let synonymsList = { "reversed_tokens" : [
		        {
		          "id": 1,
		          "name": "男人",
		          "image_url": "https://mintverse.s3.ap-northeast-1.amazonaws.com/1.png",
		          "gif_url": "https://mintverse.s3.ap-northeast-1.amazonaws.com/1.gif",
		          "caster": "",
		          "category": 1,
		          "part_of_speechs": [],
		          "synonyms": ['女人','小孩'],
		          "context": "生物特徵為雄性特徵",
		          "expire_time": 0,
		          "current_time": 1651314475,
		          "author": "甘耀明",
		          "article_title": "垃圾夢",
		          "status": 0,
		          "opensea_url": 'https://opensea.io/assets/0x984f7b398d577c0adde08293a53ae9d3b6b7a5c5/3'
		        }
		      ]}
			let article = null;
			const SearchURL = new URL(window.location.href);
			let params = SearchURL.searchParams;
			if(params.has('article')){
				$('.literature').hide();
				$('.article').show();
				article = params.get('article');
				$('#app').addClass('articlePage')
				renderArticle();
			}else{
				$('.literature').show();
				$('.article').hide();
			}
			$('header').setHeader();
			$('footer').setFooter();

			$('.content span').on('click', function(event) {
				event.preventDefault();
				console.log(event.currentTarget.innerHtml)
				//event.currentTarget.attributes['data-url'].value
				$('.message .word p').text(event.currentTarget.innerHTML);
				$('.message .context').text(event.currentTarget.attributes['data-discript'].value);
				$('.message .word a').attr("href", event.currentTarget.attributes['data-url'].value);
				$('.message').show(400);
				$('.message').css('display', 'flex');
			});
			function renderArticle(){
				data[article].article = replaceKeyWord(data[article].article);
				$('.article .title').append(data[article].title);
				$('.article .author').append('作家'+' '+data[article].author);
				$('.article .content').append(data[article].article);
			}
			function replaceKeyWord(article){
				console.log(article)
				synonymsList.reversed_tokens.forEach( function(keyword, index) {
					// statements
					article = article.replaceAll(keyword.name, `<span data-discript="${keyword.context}" data-url="${keyword.opensea_url}">${keyword.name}</span>`)
				});
				return article;
			}
			data.sort(function(a, b) {
			    return b.persent - a.persent;
			});
			data.forEach( function(item, index){
				let persent = item.persent < 100 ? `${item.persent}%` : '解鎖完成'
				let title = item.title;
				let author = item.author;
				if(item.author == '李屏瑤'){
					title = insertStr(title, 3 , '<br>')
				}
				if(item.author == '黃麗群'){

					title = insertStr(title, 7 , '<br>');
					title = insertStr(title, title.length - 5 , '<br>');
				}
				$('.cardContainer').append(`<div class="card"><div class="info"><h3>${title}</h3><p>作家 ${author}</p></div><h2>${persent}</h2></div>`)
				if(persent.includes('%')){
					$('.card').eq(index) .addClass('lock');
				}
				if(item.author == '李屏瑤'){
					$('.card').eq(index) .addClass('li');
				}
				if(item.author == '黃麗群'){
					$('.card').eq(index) .addClass('haung');
				}
				
			})
			$('.card').on('click', function(event) {
				event.preventDefault();
				/* Act on the event */
				let index = $( ".card" ).index( this );
				if(data[index].persent != 100) return;
				location.href = location.href + '?article=' + index
			});
			$('.back').on('click', function(event) {
				event.preventDefault();
				/* Act on the event */
				location.href = '/literature'
			});
			$('.goTop').on('click', function(event) {
				event.preventDefault();
				/* Act on the event */
				$('html, body').animate({scrollTop : 0},800);
				return false;
			});
			function insertStr(soure,start, newStr) {
  				return soure.slice(0, start) + newStr + soure.slice(start)
			}
		})
	</script>
</body>
</html>