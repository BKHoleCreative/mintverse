<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Mintverse</title>
	<meta name="description" content="每一個詞彙，都收藏了世界的一個部分。一群詞彙交織起來，就是一個完整的宇宙。"/>
	<meta property="og:title" content="Mintverse" />
	<meta property="og:description" content="每一個詞彙，都收藏了世界的一個部分。一群詞彙交織起來，就是一個完整的宇宙。" />
	<meta property="og:image" content="../cover.png"/>
	<link rel="icon" type="image/x-icon" href="../favicon.ico">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="../css/_reset.css">
	<link rel="stylesheet" href="../css/header.css">
	<link rel="stylesheet" href="../css/footer.css">
	<link rel="stylesheet" href="../css/mint.css">
	<link rel="stylesheet" href="../css/pop.css">
	<script src="../js/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/jquery.marquee@1.6.0/jquery.marquee.min.js"></script>
	<script src="../js/header.js"></script>
	<script src="../js/footer.js"></script>
	<script src="../js/pop.js"></script>
</head>
<body>
	<div id="app">
		<header>
		</header>
		<section class="connect" style="display: block;">
			<div class="connectWrap">
				<!-- <p>錢包地址: <span>0x000000000</span></p> -->
				<h1>MINTVERSE<br>第二宇宙辭典時程公告</h1>
				<p>第一波白單 FREEMINT</p>
				<h3>5/5 20:00 - 5/7 14:00 </h3>
				<p>開詞彙盲盒，撰寫定義</p>
				<h3>5/9 12:00</h3>
				<p>第二波公開FREEMINT</p>
				<h3>5/10 12:00</h3>
				<button id="connectWallect">連結錢包</button>
			</div>
		</section>
		<section class="mint" style="display: none;">
			<div>
				<h4>錢包：<span id="address" style="color:var(--main-color)">0x000000000000000000000</span></h4>
				<h2>您最高可鑄造<span id="max_mint">1</span>個免費詞彙</h2>
				<!-- <h2>每個錢包限量持有一個<br>詞彙加購辭典可收藏全部詞彙</h2>
				<h2>每個詞彙皆是獨一無二<br>加購辭典可收藏全部的詞彙</h2> -->
				<div class="inputWrap">
					<img  src="../image/plus.svg" alt="">
					<p><span id="mintQuantity">1</span></p>
					<img  src="../image/minus.svg" alt="">
				</div>
				<div class="mintNum">
					<p><span id="worldHasMinted">1</span><span>/</span><span>2100</span></p>
				</div>
				<div class="line"></div>
				<h2 style="margin-bottom:20px;">加購辭典可收藏<br>「10篇文獻＋2100個詞彙」</h2>
				<h5>辭典會於 5/9 00:00 空投至錢包</h5>
				<label class="check">加購辭典 (0.15 ETH)
				  <input type="checkbox" id="check">
				  <span class="checkmark"></span>
				</label>
				<div class="dictionaryNum">
					<p><span id="dictionaryHasMinted">1</span><span>/</span><span>210</span></p>
				</div>
			</div>
			<button id="mintBtn">MINT 鑄造</button>
			<a href="/law">如果你按下鑄造，表示你同意本協議</a>
		</section>
		<div class="popset"></div>
		<footer>
		</footer>
	</div>
    <!-- Web3 Integration -->
    <script type="text/javascript" src="https://unpkg.com/web3@1.6.0/dist/web3.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/web3modal@1.9.4/dist/index.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@walletconnect/web3-provider@1.6.6/dist/umd/index.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>
    <script src="../js/web3-integration.js"></script>
	<script>
		let wallet_info;
		$(document).ready(async function() {
			$('header').setHeader();
			$('footer').setFooter();
			$('.popset').setPop();

	  		// failed sample
			// $('.popset').openPop({message:'連結的地址不符合Write Story資格！',type:'failed'});
			

			// 連結錢包
			$('#connectWallect').on('click',async function(event) {
				event.preventDefault();

				// connect wallet
	            let connected = await onConnect(); 


				if(connected){
					$('.popset').openPop({message:'連結錢包成功'});
				}else{
					$('.popset').openPop({message:'連結錢包失敗',type:'failed'});
					$('#connectWallect').text('重新連結錢包');
				}


				// 設定已經被 mint 數量
				let result = await update_minting_status(); 
				settingMintData(result.word_minted_num, result.dictionary_purchase_num);

				// 決定為白名單或是公售樣式
				let whiteList = true;
				if(whiteList){
					$('.mint').addClass('whiteList');

	        		// get WL mint stauts on address
		            wallet_info = await get_wallet_info_web3();

				}else{
					$('.mint').addClass('publicSale');
					$('.mint').show();
					$('.connect').hide();
				}




			});

			// Mint

			$('#mintBtn').on('click', function(event) {
				event.preventDefault();

				$('.popset').openPop({message:'確認要白名單 Mint?',type:'check',complete:async function(){
		             let mint_result = await mint_whitelist_word(wallet_info);
		             $('.popset').hide();
		  		 }});
			});

			// 最大限制 mint 數量
			let maxMint = 1;
			$('.inputWrap img').on('click', function(event) {
				event.preventDefault();
				/* Act on the event */
				let num = $('.inputWrap span').text();
				let index = $( ".inputWrap img" ).index( this );
				num = parseInt(num);
				if(index == 0){
					num = num + 1 <= maxMint ? num + 1 : num;
				}else{
					num = num - 1 < 1 ? num  : num - 1;
				}
				$('.inputWrap span').text(num.toString());
			});

			function settingMintData(world, dictionary){
				$('#dictionaryHasMinted').empty().text(dictionary);
				$(".mint-container .mint p").empty().text(world.padStart(4, '0'));
				$('#worldHasMinted').empty().text(world);

			}

			// 縮減錢包顯示數量
			// 5/4 更新
			//$('#max_mint').text('更新錢包可以mint的數量');
			function short_wallet(str) {
		        return str.slice(0, 6) + '...' + str.slice(-4);
		    }
		    // 增加字典限制加購樣式
		    // $('.check, .dictionaryNum').addClass('disabled')
		    // $('.check input').attr('disabled', true);

		    // 增加字典賣完
		    // $('.check, .dictionaryNum').addClass('soldout')
		    // $('.check input').attr('disabled', true);

		})
	</script>
</body>
</html>